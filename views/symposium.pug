<meta charset="utf-8">
html
    head
        title Abstract
        meta(http-equiv="Content-Type", content="text/html;charset=utf-8")
        style(type='text/css').

        style(type='text/css')
            include css/maincss.css

        script(src="https://code.jquery.com/jquery-3.3.1.min.js", integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=", crossorigin="anonymous")
        link(rel='stylesheet', href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css', integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO', crossorigin='anonymous')
        link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css', integrity='sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp', crossorigin='anonymous')
        script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js', integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49', crossorigin='anonymous')
        script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js', integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy', crossorigin='anonymous')
    
    body
        include topnav.pug

        div#main-container
            center
                h2(style="letter-spacing: 2px;") Symposium Submission Form
            br
            form
                .form-group.shadow-sm
                    div.fullwidth
                        h4 Please enter the title for your proposed Symposium
                        p (150 character Limit)
                    br
                    h5 English
                    input.charLimit.inputText.form-control(type="text", name='englishTitleInput')
                    div.charLimitDisplay
                    br
                    h5 Spanish
                    input.charLimit.inputText.form-control(type="text", name='spanishTitleInput')
                    div.charLimitDisplay

                .form-group.shadow-sm
                    div.fullwidth
                        h4 Please enter the names and affiliations of the Symposium organizers
                    .rightInput
                        span#Label34
                    div.fullwidth
                        .formInfo
                            h4 Which author is presenting? 
                        .rightInput
                            input.inputText.form-control(type="text", name='presenterInput')


                    table(id="authorTable")
                        tr
                            th(style="width: 20px;") #
                            th First Name
                            th Middle or Initial
                            th Last Name
                            th Primary Institution
                            th Phone
                            th Email
                        tr
                            td(style="font-size: 16px") 1
                            td 
                                input.inputText.form-control(type='text')
                            td 
                                input.inputText.form-control(type='text')
                            td 
                                input.inputText.form-control(type='text')
                            td 
                                input.inputText.form-control(type='text')
                            td 
                                input.inputText.form-control(type='text')
                            td
                                input.inputText.form-control(type='text')
                    div.authorBtnBox
                        button(id="addAuthorBtn", class="btn btn-primary") Add Author
                        button(id="deleteAuthorBtn", class="btn btn-secondary") Delete Author

                .form-group.shadow-sm
                    h4 Please enter a brief description of your proposed Symposium in 250 words or less
                    br
                    h5 English
                    textarea.wordLimit.inputText.form-control(name='englishAbstractInput', style="width: 100% ")
                    div.wordLimitDisplay
                    br
                    h5 Spanish
                    textarea.wordLimit.inputText.form-control(name='spanishAbstractInput', style="width: 100% ")
                    div.wordLimitDisplay

                .form-group.shadow-sm
                    div.fullwidth
                        h4 Please indicate whether you are interested in planning a half day (eight presentation slots) or full day (16 presentation slots) Symposium
                        .rightInput
                            select.form-control(name='RadComboBox139_DropDown')
                                option(value="", disabled, selected) Select
                                option  Half Day
                                option  Full Day 
                .form-group.shadow-sm
                    div.fullwidth
                        h4 Please enter the names and presentation topics of any Symposium participants you have in mind 
                        p You do not need to identify all presenters, just those you already know will be invited

                    table(id="topicTable")
                        tr
                            th(style="width: 20px;") #
                            th Name
                            th Topic
                        tr
                            td(style="font-size: 16px") 1
                            td 
                                input.inputText.form-control(type='text')
                            td 
                                input.inputText.charLimit.form-control(type='text', style="width: 600px;")
                    div.authorBtnBox
                        button(id="addTopicButton", class="btn btn-primary") Add Row
                        button(id="deleteTopicButton", class="btn btn-secondary") Delete Row
                .form-group.shadow-sm
                    h4 Please enter any notes to the Scientific Committee
                    textarea#TextBox152.inputText.form-control(name='TextBox152')
                .form-group
                    button(type="submit" class="btn btn-primary", style="float: right") Submit


script.

    $( document ).ready(function() {

    $('#addAuthorBtn').on('click', function(event) {
        event.preventDefault();
        $trLast = $('#authorTable tr:last');
        var prevnum = $trLast.find('td:first').html();
        $trNew = $trLast.clone();
        $trNew.find('td:first').html(parseInt(prevnum) + 1);
        $trLast.after($trNew);
        $('#authorTable tr:last').find('input').val('');
    });

    $('#addTopicButton').on('click', function(event) {
        event.preventDefault();
        $trLast = $('#topicTable tr:last');
        var prevnum = $trLast.find('td:first').html();
        $trNew = $trLast.clone();
        $trNew.find('td:first').html(parseInt(prevnum) + 1);
        $trLast.after($trNew);
        $('#topicTable tr:last').find('input').val('');
    });

    $('#deleteAuthorBtn').on('click', function(event) {
        event.preventDefault();
        $trLast = $('#authorTable tr:last').remove();
    });

    var wordCount = function( val ){
        var wom = val.match(/\S+/g);
        return {
            charactersNoSpaces : val.replace(/\s+/g, '').length,
            characters         : val.length,
            words              : wom ? wom.length : 0,
            lines              : val.split(/\r*\n/).length
        };
    }

    $('.wordLimit').on('keydown change', function () {

        var v = wordCount( $(this).val() );

        if (v.words > 250) {
          var trimmed = $(this).val().split(/\s+/, 250).join(" ");
          $(this).val(trimmed + " ");
          v.words = 250;
        }

        $(this).next('.wordLimitDisplay').html("Words: "+ v.words);

    });

    $('.charLimit').on('keyup keydown change', function () {

        $(this).val($(this).val().substring(0, 150));
        var v = wordCount( $(this).val() );
        $(this).next('.charLimitDisplay').html("Characters: "+ v.characters);

    });

    // Form Submission
    $( "form" ).on( "submit", function( event ) {
        event.preventDefault();
        var formdata = $( this ).serialize();


        $.ajax({ 
           url: '/postform',
           type: 'POST',
           cache: false, 
           data: formdata, 
           success: function(data){
              alert('Success!')
           },
           error: function(jqXHR, textStatus, err){
               alert('text status '+textStatus+', err '+err)
           }
        })

        console.log( $( this ).serialize() );

     });
    });